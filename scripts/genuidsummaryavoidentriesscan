EPATH=..
echo "create uid summary records in summary tables in $1"
$EPATH/bfq -i $1 -S "insert into summary (uid,totfiles,totlinks,minuid,maxuid,mingid,maxgid,minsize,maxsize,totltk,totmtk,totltm,totmtm,totmtg,totmtt,totsize,minctime,maxctime,minmtime,maxmtime,minatime,maxatime,minblocks,maxblocks,totxattr,mincrtime,maxcrtime,minossint1,maxossint1,totossint1,minossint2,maxossint2,totossint2,minossint3,maxossint3,totossint3,minossint4,maxossint4,totossint4,rectype) select uid,totfiles,totlinks,minuid,maxuid,mingid,maxgid,minsize,maxsize,totltk,totmtk,totltm,totmtm,totmtg,totmtt,totsize,minctime,maxctime,minmtime,maxmtime,minatime,maxatime,minblocks,maxblocks,totxattr,mincrtime,maxcrtime,minossint1,maxossint1,totossint1,minossint2,maxossint2,totossint2,minossint3,maxossint3,totossint3,minossint4,maxossint4,totossint4,1 from summary where rectype=0 and minuid=maxuid; select uid from summary where rectype=0 and minuid!=maxuid;" -E "insert into summary (uid,totfiles,totlinks,minuid,maxuid,mingid,maxgid,minsize,maxsize,totltk,totmtk,totltm,totmtm,totmtg,totmtt,totsize,minctime,maxctime,minmtime,maxmtime,minatime,maxatime,minblocks,maxblocks,totxattr,mincrtime,maxcrtime,minossint1,maxossint1,totossint1,minossint2,maxossint2,totossint2,minossint3,maxossint3,totossint3,minossint4,maxossint4,totossint4,rectype) select uid,sum(CASE WHEN type='f' THEN 1 ELSE 0 END),sum(CASE WHEN type='l' THEN 1 ELSE 0 END),min(uid),max(uid),min(gid),max(gid),min(size),max(size),sum(case when size<=1024 then 1 else 0 end),sum(case when size>1024 then 1 else 0 end),sum(case when size<=1048576 then 1 else 0 end),sum(case when size>1048576 then 1 else 0 end),sum(case when size>1073741824 then 1 else 0 end),sum(case when size>1099511627776 then 1 else 0 end),sum(size),min(ctime),max(ctime),min(mtime),max(mtime),min(atime),max(atime),min(blocks),max(blocks),sum(xattrs),min(crtime),max(crtime),min(ossint1),max(ossint1),sum(ossint1),min(ossint2),max(ossint2),sum(ossint2),min(ossint3),max(ossint3),sum(ossint3),min(ossint4),max(ossint4),sum(ossint4),1 from entries where type='f' group by uid;" -n2
