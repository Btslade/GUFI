# Start with no treesummary tables

# Dry Run (7 xattrs because directory xattrs are not counted in the summary)
totfiles 13 totlinks 2
totltk 12 totmtk 1 totltm 13 totmtm 0 totmtg 0 totmtt 0
totsubdirs 4
totxattr 7

# Still no treesummary table

# Generate treesummary table in prefix/leaf_directory
totfiles 2 totlinks 0
totltk 2 totmtk 0 totltm 2 totmtm 0 totmtg 0 totmtt 0
totsubdirs 0
totxattr 6

# One treesummary table
treesummary

# Generate treesummary table in prefix
totfiles 13 totlinks 2
totltk 12 totmtk 1 totltm 13 totmtm 0 totmtg 0 totmtt 0
totsubdirs 4
totxattr 7

# Two treesummary tables
treesummary
treesummary

# Find file sizes in range
$ gufi_query -d ' ' -T "SELECT '' FROM tree.treesummary WHERE (minsize <= 0) AND (10 < maxsize);" -E "SELECT path() || '/' || name, size FROM pentries WHERE (0 <= size) AND (size <= 10);" prefix

prefix/.hidden 5
prefix/directory/executable 1
prefix/directory/readonly 2
prefix/directory/subdirectory/repeat_name 4
prefix/directory/writable 3
prefix/empty_file 0
prefix/old_file 8
prefix/repeat_name 4
prefix/unusual#? directory ,/unusual, name?# 9


# Find directories that have xattrs
$ gufi_query -d ' ' -T "SELECT '' FROM tree.treesummary WHERE totxattr >  0;" -S "SELECT path(), totxattr FROM summary WHERE totxattr > 0;" prefix

prefix 1

prefix/leaf_directory 6


# Walk this tree if it does not have xattrs
$ gufi_query -d ' ' -T "SELECT '' FROM tree.treesummary WHERE totxattr == 0;" -S "SELECT path(), totxattr FROM summary;" prefix


